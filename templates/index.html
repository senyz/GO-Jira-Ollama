<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оффлайн-запросы в ИИ</title>
</head>
<body>
    <h1>Список моделей ИИ:</h1>
    <ul>
        {% for model in models %}
            <li>{{ model.name }}</li>
        {% endfor %}
    </ul>

    <form action="/send" method="post">
        {{ csrfToken }}
        <label for="projectKey">Ключ проекта Jira:</label>
        <input type="text" id="projectKey" name="projectKey"><br><br>
        <label for="messages">Вопросы к ИИ:</label><br>
        <textarea id="messages" name="messages"></textarea><br><br>
        <input type="submit" value="Отправить">
    </form>

    {% if tasks %}
        <h1>Найденные задачи:</h1>
        <ul>
            {% for task in tasks %}
                <li>{{ task.key }} ({{ task.summary }})
                    {{ task.description }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <div id="response"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Проверяем, есть ли задачи
            if ($('#tasks').length > 0) {
                // Если да, то показываем их
                $('#tasks').show();
            }

            // Событие submit формы
            $('form').submit(function (e) {
                e.preventDefault();

                // Получаем данные из формы
                var projectKey = $('#projectKey').val();
                var messages = $('#messages').val().split('\n');

                // Отправляем запрос на сервер
                $.post('/send', { projectKey: projectKey, messages: messages }, function (data) {
                    // Показываем ответ от сервера
                    $('#response').html(data);
                });
            });

            // Событие загрузки страницы
            $(window).load(function () {
                // Получаем данные о задачах из сервера
                $.get('/tasks', function (data) {
                    // Показываем задачи на странице
                    $('#tasks').html(data);
                });
            });
        });
    </script>
</body>
</html>